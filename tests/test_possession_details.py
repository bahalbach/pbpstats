# tests cases in methods in pbpstats/possession_details.py that don't get covered in test game
import pbpstats
import pytest
from pbpstats.possession_details import PossessionDetails, PbpEventOrderErrorException
from pbpstats.stats_pbp_event import StatsPbpEvent


class TestPossessionDetails:
    def test_jump_ball_deadball_ends_possession(self):
        possession = PossessionDetails(
            PossessionNumber=7,
            Events=[
                StatsPbpEvent({'GAME_ID': '0021800136', 'EVENTNUM': 426, 'EVENTMSGTYPE': 6, 'EVENTMSGACTIONTYPE': 1, 'PERIOD': 3, 'WCTIMESTRING': '9:47 PM', 'PCTIMESTRING': '5:45', 'HOMEDESCRIPTION': 'Booker P.FOUL (P5.PN) (K.Fitzgerald)', 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': None, 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 4, 'PLAYER1_ID': 1626164, 'PLAYER1_NAME': 'Devin Booker', 'PLAYER1_TEAM_ID': 1610612756, 'PLAYER1_TEAM_CITY': 'Phoenix', 'PLAYER1_TEAM_NICKNAME': 'Suns', 'PLAYER1_TEAM_ABBREVIATION': 'PHX', 'PERSON2TYPE': 5, 'PLAYER2_ID': 201188, 'PLAYER2_NAME': 'Marc Gasol', 'PLAYER2_TEAM_ID': 1610612763, 'PLAYER2_TEAM_CITY': 'Memphis', 'PLAYER2_TEAM_NICKNAME': 'Grizzlies', 'PLAYER2_TEAM_ABBREVIATION': 'MEM', 'PERSON3TYPE': 1, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 1, 'home_score': 63, 'visitor_score': 71}),
                StatsPbpEvent({'GAME_ID': '0021800136', 'EVENTNUM': 433, 'EVENTMSGTYPE': 3, 'EVENTMSGACTIONTYPE': 11, 'PERIOD': 3, 'WCTIMESTRING': '9:48 PM', 'PCTIMESTRING': '5:45', 'HOMEDESCRIPTION': None, 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': 'Gasol Free Throw 1 of 2 (4 PTS)', 'SCORE': '72 - 63', 'SCOREMARGIN': '-9', 'PERSON1TYPE': 5, 'PLAYER1_ID': 201188, 'PLAYER1_NAME': 'Marc Gasol', 'PLAYER1_TEAM_ID': 1610612763, 'PLAYER1_TEAM_CITY': 'Memphis', 'PLAYER1_TEAM_NICKNAME': 'Grizzlies', 'PLAYER1_TEAM_ABBREVIATION': 'MEM', 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 63, 'visitor_score': 72}),
                StatsPbpEvent({'GAME_ID': '0021800136', 'EVENTNUM': 436, 'EVENTMSGTYPE': 3, 'EVENTMSGACTIONTYPE': 12, 'PERIOD': 3, 'WCTIMESTRING': '9:48 PM', 'PCTIMESTRING': '5:45', 'HOMEDESCRIPTION': None, 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': 'Gasol Free Throw 2 of 2 (5 PTS)', 'SCORE': '73 - 63', 'SCOREMARGIN': '-9', 'PERSON1TYPE': 5, 'PLAYER1_ID': 201188, 'PLAYER1_NAME': 'Marc Gasol', 'PLAYER1_TEAM_ID': 1610612763, 'PLAYER1_TEAM_CITY': 'Memphis', 'PLAYER1_TEAM_NICKNAME': 'Grizzlies', 'PLAYER1_TEAM_ABBREVIATION': 'MEM', 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 63, 'visitor_score': 73})
            ],
            PreviousPossessionEvents=[
                StatsPbpEvent({'GAME_ID': '0021800136', 'EVENTNUM': 483, 'EVENTMSGTYPE': 10, 'EVENTMSGACTIONTYPE': 0, 'PERIOD': 3, 'WCTIMESTRING': '9:46 PM', 'PCTIMESTRING': '5:46', 'HOMEDESCRIPTION': 'Jump Ball Booker vs. Gasol: Tip to', 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': None, 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 4, 'PLAYER1_ID': 1626164, 'PLAYER1_NAME': 'Devin Booker', 'PLAYER1_TEAM_ID': 1610612756, 'PLAYER1_TEAM_CITY': 'Phoenix', 'PLAYER1_TEAM_NICKNAME': 'Suns', 'PLAYER1_TEAM_ABBREVIATION': 'PHX', 'PERSON2TYPE': 5, 'PLAYER2_ID': 201188, 'PLAYER2_NAME': 'Marc Gasol', 'PLAYER2_TEAM_ID': 1610612763, 'PLAYER2_TEAM_CITY': 'Memphis', 'PLAYER2_TEAM_NICKNAME': 'Grizzlies', 'PLAYER2_TEAM_ABBREVIATION': 'MEM', 'PERSON3TYPE': 3, 'PLAYER3_ID': 1610612763, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 1, 'home_score': 63, 'visitor_score': 71})
            ]
        )
        possession.add_previous_possession_ending_data()
        assert possession.StartType == pbpstats.OFF_DEADBALL_STRING

    def test_jump_ball_liveball_ends_possession(self):
        possession = PossessionDetails(
            PossessionNumber=7,
            Events=[
                StatsPbpEvent({'GAME_ID': '0021800455', 'EVENTNUM': 250, 'EVENTMSGTYPE': 6, 'EVENTMSGACTIONTYPE': 1, 'PERIOD': 2, 'WCTIMESTRING': '7:56 PM', 'PCTIMESTRING': '3:28', 'HOMEDESCRIPTION': None, 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': 'Sexton P.FOUL (P3.T4) (J.Phillips)', 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 5, 'PLAYER1_ID': 1629012, 'PLAYER1_NAME': 'Collin Sexton', 'PLAYER1_TEAM_ID': 1610612739, 'PLAYER1_TEAM_CITY': 'Cleveland', 'PLAYER1_TEAM_NICKNAME': 'Cavaliers', 'PLAYER1_TEAM_ABBREVIATION': 'CLE', 'PERSON2TYPE': 4, 'PLAYER2_ID': 202689, 'PLAYER2_NAME': 'Kemba Walker', 'PLAYER2_TEAM_ID': 1610612766, 'PLAYER2_TEAM_CITY': 'Charlotte', 'PLAYER2_TEAM_NICKNAME': 'Hornets', 'PLAYER2_TEAM_ABBREVIATION': 'CHA', 'PERSON3TYPE': 1, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 1, 'home_score': 31, 'visitor_score': 41}),
                StatsPbpEvent({'GAME_ID': '0021800455', 'EVENTNUM': 255, 'EVENTMSGTYPE': 1, 'EVENTMSGACTIONTYPE': 1, 'PERIOD': 2, 'WCTIMESTRING': '7:56 PM', 'PCTIMESTRING': '3:12', 'HOMEDESCRIPTION': "Walker 15' Jump Shot (6 PTS)", 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': None, 'SCORE': '41 - 33', 'SCOREMARGIN': '-8', 'PERSON1TYPE': 4, 'PLAYER1_ID': 202689, 'PLAYER1_NAME': 'Kemba Walker', 'PLAYER1_TEAM_ID': 1610612766, 'PLAYER1_TEAM_CITY': 'Charlotte', 'PLAYER1_TEAM_NICKNAME': 'Hornets', 'PLAYER1_TEAM_ABBREVIATION': 'CHA', 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 1, 'home_score': 33, 'visitor_score': 41})
            ],
            PreviousPossessionEvents=[
                StatsPbpEvent({'GAME_ID': '0021800455', 'EVENTNUM': 242, 'EVENTMSGTYPE': 3, 'EVENTMSGACTIONTYPE': 11, 'PERIOD': 2, 'WCTIMESTRING': '7:55 PM', 'PCTIMESTRING': '3:34', 'HOMEDESCRIPTION': None, 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': 'Nwaba Free Throw 1 of 2 (1 PTS)', 'SCORE': '41 - 31', 'SCOREMARGIN': '-10', 'PERSON1TYPE': 5, 'PLAYER1_ID': 1628021, 'PLAYER1_NAME': 'David Nwaba', 'PLAYER1_TEAM_ID': 1610612739, 'PLAYER1_TEAM_CITY': 'Cleveland', 'PLAYER1_TEAM_NICKNAME': 'Cavaliers', 'PLAYER1_TEAM_ABBREVIATION': 'CLE', 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 31, 'visitor_score': 41}),
                StatsPbpEvent({'GAME_ID': '0021800455', 'EVENTNUM': 245, 'EVENTMSGTYPE': 7, 'EVENTMSGACTIONTYPE': 6, 'PERIOD': 2, 'WCTIMESTRING': '7:55 PM', 'PCTIMESTRING': '3:34', 'HOMEDESCRIPTION': None, 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': 'Zizic Violation:Double Lane (.)', 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 5, 'PLAYER1_ID': 1627790, 'PLAYER1_NAME': 'Ante Zizic', 'PLAYER1_TEAM_ID': 1610612739, 'PLAYER1_TEAM_CITY': 'Cleveland', 'PLAYER1_TEAM_NICKNAME': 'Cavaliers', 'PLAYER1_TEAM_ABBREVIATION': 'CLE', 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 31, 'visitor_score': 41}),
                StatsPbpEvent({'GAME_ID': '0021800455', 'EVENTNUM': 246, 'EVENTMSGTYPE': 7, 'EVENTMSGACTIONTYPE': 6, 'PERIOD': 2, 'WCTIMESTRING': '7:55 PM', 'PCTIMESTRING': '3:34', 'HOMEDESCRIPTION': 'Zeller Violation:Double Lane (.)', 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': None, 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 4, 'PLAYER1_ID': 203469, 'PLAYER1_NAME': 'Cody Zeller', 'PLAYER1_TEAM_ID': 1610612766, 'PLAYER1_TEAM_CITY': 'Charlotte', 'PLAYER1_TEAM_NICKNAME': 'Hornets', 'PLAYER1_TEAM_ABBREVIATION': 'CHA', 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 31, 'visitor_score': 41}),
                StatsPbpEvent({'GAME_ID': '0021800455', 'EVENTNUM': 247, 'EVENTMSGTYPE': 10, 'EVENTMSGACTIONTYPE': 0, 'PERIOD': 2, 'WCTIMESTRING': '7:55 PM', 'PCTIMESTRING': '3:34', 'HOMEDESCRIPTION': 'Jump Ball Zeller vs. Zizic: Tip to Walker', 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': None, 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 4, 'PLAYER1_ID': 203469, 'PLAYER1_NAME': 'Cody Zeller', 'PLAYER1_TEAM_ID': 1610612766, 'PLAYER1_TEAM_CITY': 'Charlotte', 'PLAYER1_TEAM_NICKNAME': 'Hornets', 'PLAYER1_TEAM_ABBREVIATION': 'CHA', 'PERSON2TYPE': 5, 'PLAYER2_ID': 1627790, 'PLAYER2_NAME': 'Ante Zizic', 'PLAYER2_TEAM_ID': 1610612739, 'PLAYER2_TEAM_CITY': 'Cleveland', 'PLAYER2_TEAM_NICKNAME': 'Cavaliers', 'PLAYER2_TEAM_ABBREVIATION': 'CLE', 'PERSON3TYPE': 4, 'PLAYER3_ID': 202689, 'PLAYER3_NAME': 'Kemba Walker', 'PLAYER3_TEAM_ID': 1610612766, 'PLAYER3_TEAM_CITY': 'Charlotte', 'PLAYER3_TEAM_NICKNAME': 'Hornets', 'PLAYER3_TEAM_ABBREVIATION': 'CHA', 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 31, 'visitor_score': 41})
            ]
        )
        possession.add_previous_possession_ending_data()
        assert possession.StartType == pbpstats.OFF_LIVE_BALL_TURNOVER_STRING

    def test_timeout_on_current_possession(self):
        possession = PossessionDetails(
            PossessionNumber=7,
            EndTime=402,
            StartTime=411,
            Events=[
                StatsPbpEvent({'GAME_ID': '0021800001', 'EVENTNUM': 66, 'EVENTMSGTYPE': 9, 'EVENTMSGACTIONTYPE': 1, 'PERIOD': 1, 'WCTIMESTRING': '8:10 PM', 'PCTIMESTRING': '6:51', 'HOMEDESCRIPTION': 'CELTICS Timeout: Regular (Full 1 Short 0)', 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': None, 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 2, 'PLAYER1_ID': 1610612738, 'PLAYER1_NAME': None, 'PLAYER1_TEAM_ID': None, 'PLAYER1_TEAM_CITY': None, 'PLAYER1_TEAM_NICKNAME': None, 'PLAYER1_TEAM_ABBREVIATION': None, 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 7, 'visitor_score': 8}),
                StatsPbpEvent({'GAME_ID': '0021800001', 'EVENTNUM': 67, 'EVENTMSGTYPE': 8, 'EVENTMSGACTIONTYPE': 0, 'PERIOD': 1, 'WCTIMESTRING': '8:13 PM', 'PCTIMESTRING': '6:51', 'HOMEDESCRIPTION': None, 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': 'SUB: Johnson FOR Saric', 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 5, 'PLAYER1_ID': 203967, 'PLAYER1_NAME': 'Dario Saric', 'PLAYER1_TEAM_ID': 1610612755, 'PLAYER1_TEAM_CITY': 'Philadelphia', 'PLAYER1_TEAM_NICKNAME': '76ers', 'PLAYER1_TEAM_ABBREVIATION': 'PHI', 'PERSON2TYPE': 5, 'PLAYER2_ID': 101161, 'PLAYER2_NAME': 'Amir Johnson', 'PLAYER2_TEAM_ID': 1610612755, 'PLAYER2_TEAM_CITY': 'Philadelphia', 'PLAYER2_TEAM_NICKNAME': '76ers', 'PLAYER2_TEAM_ABBREVIATION': 'PHI', 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 7, 'visitor_score': 8}),
                StatsPbpEvent({'GAME_ID': '0021800001', 'EVENTNUM': 68, 'EVENTMSGTYPE': 8, 'EVENTMSGACTIONTYPE': 0, 'PERIOD': 1, 'WCTIMESTRING': '8:13 PM', 'PCTIMESTRING': '6:51', 'HOMEDESCRIPTION': None, 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': 'SUB: Redick FOR Embiid', 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 5, 'PLAYER1_ID': 203954, 'PLAYER1_NAME': 'Joel Embiid', 'PLAYER1_TEAM_ID': 1610612755, 'PLAYER1_TEAM_CITY': 'Philadelphia', 'PLAYER1_TEAM_NICKNAME': '76ers', 'PLAYER1_TEAM_ABBREVIATION': 'PHI', 'PERSON2TYPE': 5, 'PLAYER2_ID': 200755, 'PLAYER2_NAME': 'JJ Redick', 'PLAYER2_TEAM_ID': 1610612755, 'PLAYER2_TEAM_CITY': 'Philadelphia', 'PLAYER2_TEAM_NICKNAME': '76ers', 'PLAYER2_TEAM_ABBREVIATION': 'PHI', 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 7, 'visitor_score': 8}),
                StatsPbpEvent({'GAME_ID': '0021800001', 'EVENTNUM': 71, 'EVENTMSGTYPE': 5, 'EVENTMSGACTIONTYPE': 1, 'PERIOD': 1, 'WCTIMESTRING': '8:14 PM', 'PCTIMESTRING': '6:42', 'HOMEDESCRIPTION': 'Hayward STEAL (2 STL)', 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': 'Covington Bad Pass Turnover (P1.T3)', 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 5, 'PLAYER1_ID': 203496, 'PLAYER1_NAME': 'Robert Covington', 'PLAYER1_TEAM_ID': 1610612755, 'PLAYER1_TEAM_CITY': 'Philadelphia', 'PLAYER1_TEAM_NICKNAME': '76ers', 'PLAYER1_TEAM_ABBREVIATION': 'PHI', 'PERSON2TYPE': 4, 'PLAYER2_ID': 202330, 'PLAYER2_NAME': 'Gordon Hayward', 'PLAYER2_TEAM_ID': 1610612738, 'PLAYER2_TEAM_CITY': 'Boston', 'PLAYER2_TEAM_NICKNAME': 'Celtics', 'PLAYER2_TEAM_ABBREVIATION': 'BOS', 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 1, 'home_score': 7, 'visitor_score': 8})
            ],
            PreviousPossessionEvents=[
                StatsPbpEvent({'GAME_ID': '0021800001', 'EVENTNUM': 63, 'EVENTMSGTYPE': 2, 'EVENTMSGACTIONTYPE': 6, 'PERIOD': 1, 'WCTIMESTRING': '8:10 PM', 'PCTIMESTRING': '6:51', 'HOMEDESCRIPTION': "MISS Brown 2' Driving Layup", 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': 'Covington BLOCK (1 BLK)', 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 4, 'PLAYER1_ID': 1627759, 'PLAYER1_NAME': 'Jaylen Brown', 'PLAYER1_TEAM_ID': 1610612738, 'PLAYER1_TEAM_CITY': 'Boston', 'PLAYER1_TEAM_NICKNAME': 'Celtics', 'PLAYER1_TEAM_ABBREVIATION': 'BOS', 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 5, 'PLAYER3_ID': 203496, 'PLAYER3_NAME': 'Robert Covington', 'PLAYER3_TEAM_ID': 1610612755, 'PLAYER3_TEAM_CITY': 'Philadelphia', 'PLAYER3_TEAM_NICKNAME': '76ers', 'PLAYER3_TEAM_ABBREVIATION': 'PHI', 'VIDEO_AVAILABLE_FLAG': 1, 'home_score': 7, 'visitor_score': 8}),
                StatsPbpEvent({'GAME_ID': '0021800001', 'EVENTNUM': 65, 'EVENTMSGTYPE': 4, 'EVENTMSGACTIONTYPE': 0, 'PERIOD': 1, 'WCTIMESTRING': '8:10 PM', 'PCTIMESTRING': '6:51', 'HOMEDESCRIPTION': None, 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': '76ers Rebound', 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 3, 'PLAYER1_ID': 1610612755, 'PLAYER1_NAME': None, 'PLAYER1_TEAM_ID': None, 'PLAYER1_TEAM_CITY': None, 'PLAYER1_TEAM_NICKNAME': None, 'PLAYER1_TEAM_ABBREVIATION': None, 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 7, 'visitor_score': 8})
            ]
        )
        assert possession.possession_has_timeout() is True
        possession.add_previous_possession_ending_data()
        assert possession.StartType == pbpstats.OFF_TIMEOUT_STRING

    def test_timeout_followed_by_turnover_at_same_time(self):
        possession = PossessionDetails(
            PossessionNumber=7,
            EndTime=390,
            StartTime=399,
            Events=[
                StatsPbpEvent({'GAME_ID': '0021800238', 'EVENTNUM': 59, 'EVENTMSGTYPE': 9, 'EVENTMSGACTIONTYPE': 1, 'PERIOD': 1, 'WCTIMESTRING': '7:19 PM', 'PCTIMESTRING': '6:30', 'HOMEDESCRIPTION': 'SPURS Timeout: Regular (Full 1 Short 0)', 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': None, 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 2, 'PLAYER1_ID': 1610612759, 'PLAYER1_NAME': None, 'PLAYER1_TEAM_ID': None, 'PLAYER1_TEAM_CITY': None, 'PLAYER1_TEAM_NICKNAME': None, 'PLAYER1_TEAM_ABBREVIATION': None, 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 17, 'visitor_score': 12}),
                StatsPbpEvent({'GAME_ID': '0021800238', 'EVENTNUM': 60, 'EVENTMSGTYPE': 8, 'EVENTMSGACTIONTYPE': 0, 'PERIOD': 1, 'WCTIMESTRING': '7:20 PM', 'PCTIMESTRING': '6:30', 'HOMEDESCRIPTION': 'SUB: Belinelli FOR Cunningham', 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': None, 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 4, 'PLAYER1_ID': 201967, 'PLAYER1_NAME': 'Dante Cunningham', 'PLAYER1_TEAM_ID': 1610612759, 'PLAYER1_TEAM_CITY': 'San Antonio', 'PLAYER1_TEAM_NICKNAME': 'Spurs', 'PLAYER1_TEAM_ABBREVIATION': 'SAS', 'PERSON2TYPE': 4, 'PLAYER2_ID': 201158, 'PLAYER2_NAME': 'Marco Belinelli', 'PLAYER2_TEAM_ID': 1610612759, 'PLAYER2_TEAM_CITY': 'San Antonio', 'PLAYER2_TEAM_NICKNAME': 'Spurs', 'PLAYER2_TEAM_ABBREVIATION': 'SAS', 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 17, 'visitor_score': 12}),
                StatsPbpEvent({'GAME_ID': '0021800238', 'EVENTNUM': 62, 'EVENTMSGTYPE': 5, 'EVENTMSGACTIONTYPE': 9, 'PERIOD': 1, 'WCTIMESTRING': '7:22 PM', 'PCTIMESTRING': '6:30', 'HOMEDESCRIPTION': 'SPURS Turnover: 5 Second Violation (T#1)', 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': None, 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 2, 'PLAYER1_ID': 1610612759, 'PLAYER1_NAME': None, 'PLAYER1_TEAM_ID': None, 'PLAYER1_TEAM_CITY': None, 'PLAYER1_TEAM_NICKNAME': None, 'PLAYER1_TEAM_ABBREVIATION': None, 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 1, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 17, 'visitor_score': 12})
            ],
            PreviousPossessionEvents=[
                StatsPbpEvent({'GAME_ID': '0021800238', 'EVENTNUM': 57, 'EVENTMSGTYPE': 1, 'EVENTMSGACTIONTYPE': 7, 'PERIOD': 1, 'WCTIMESTRING': '7:18 PM', 'PCTIMESTRING': '6:39', 'HOMEDESCRIPTION': None, 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': "Jones 2' Dunk (2 PTS) (Iguodala 1 AST)", 'SCORE': '12 - 17', 'SCOREMARGIN': '5', 'PERSON1TYPE': 5, 'PLAYER1_ID': 1627745, 'PLAYER1_NAME': 'Damian Jones', 'PLAYER1_TEAM_ID': 1610612744, 'PLAYER1_TEAM_CITY': 'Golden State', 'PLAYER1_TEAM_NICKNAME': 'Warriors', 'PLAYER1_TEAM_ABBREVIATION': 'GSW', 'PERSON2TYPE': 5, 'PLAYER2_ID': 2738, 'PLAYER2_NAME': 'Andre Iguodala', 'PLAYER2_TEAM_ID': 1610612744, 'PLAYER2_TEAM_CITY': 'Golden State', 'PLAYER2_TEAM_NICKNAME': 'Warriors', 'PLAYER2_TEAM_ABBREVIATION': 'GSW', 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 1, 'home_score': 17, 'visitor_score': 12}),
            ]
        )
        assert possession.possession_has_timeout() is True
        possession.add_previous_possession_ending_data()
        assert possession.StartType == pbpstats.OFF_TIMEOUT_STRING

    def test_timeout_between_fts_isnt_counted(self):
        possession = PossessionDetails(
            PossessionNumber=7,
            EndTime=435,
            StartTime=445,
            Events=[
                StatsPbpEvent({'GAME_ID': '0021800002', 'EVENTNUM': 71, 'EVENTMSGTYPE': 5, 'EVENTMSGACTIONTYPE': 45, 'PERIOD': 1, 'WCTIMESTRING': '11:09 PM', 'PCTIMESTRING': '7:15', 'HOMEDESCRIPTION': None, 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': 'Schroder Out of Bounds - Bad Pass Turnover Turnover (P1.T3)', 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 5, 'PLAYER1_ID': 203471, 'PLAYER1_NAME': 'Dennis Schroder', 'PLAYER1_TEAM_ID': 1610612760, 'PLAYER1_TEAM_CITY': 'Oklahoma City', 'PLAYER1_TEAM_NICKNAME': 'Thunder', 'PLAYER1_TEAM_ABBREVIATION': 'OKC', 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 1, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 1, 'home_score': 16, 'visitor_score': 8}),
            ],
            PreviousPossessionEvents=[
                StatsPbpEvent({'GAME_ID': '0021800002', 'EVENTNUM': 66, 'EVENTMSGTYPE': 6, 'EVENTMSGACTIONTYPE': 2, 'PERIOD': 1, 'WCTIMESTRING': '11:05 PM', 'PCTIMESTRING': '7:25', 'HOMEDESCRIPTION': None, 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': 'Schroder S.FOUL (P1.T1) (B.Forte)', 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 5, 'PLAYER1_ID': 203471, 'PLAYER1_NAME': 'Dennis Schroder', 'PLAYER1_TEAM_ID': 1610612760, 'PLAYER1_TEAM_CITY': 'Oklahoma City', 'PLAYER1_TEAM_NICKNAME': 'Thunder', 'PLAYER1_TEAM_ABBREVIATION': 'OKC', 'PERSON2TYPE': 4, 'PLAYER2_ID': 201939, 'PLAYER2_NAME': 'Stephen Curry', 'PLAYER2_TEAM_ID': 1610612744, 'PLAYER2_TEAM_CITY': 'Golden State', 'PLAYER2_TEAM_NICKNAME': 'Warriors', 'PLAYER2_TEAM_ABBREVIATION': 'GSW', 'PERSON3TYPE': 1, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 1, 'home_score': 14, 'visitor_score': 8}),
                StatsPbpEvent({'GAME_ID': '0021800002', 'EVENTNUM': 68, 'EVENTMSGTYPE': 3, 'EVENTMSGACTIONTYPE': 11, 'PERIOD': 1, 'WCTIMESTRING': '11:05 PM', 'PCTIMESTRING': '7:25', 'HOMEDESCRIPTION': 'Curry Free Throw 1 of 2 (6 PTS)', 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': None, 'SCORE': '8 - 15', 'SCOREMARGIN': '7', 'PERSON1TYPE': 4, 'PLAYER1_ID': 201939, 'PLAYER1_NAME': 'Stephen Curry', 'PLAYER1_TEAM_ID': 1610612744, 'PLAYER1_TEAM_CITY': 'Golden State', 'PLAYER1_TEAM_NICKNAME': 'Warriors', 'PLAYER1_TEAM_ABBREVIATION': 'GSW', 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 15, 'visitor_score': 8}),
                StatsPbpEvent({'GAME_ID': '0021800002', 'EVENTNUM': 69, 'EVENTMSGTYPE': 9, 'EVENTMSGACTIONTYPE': 1, 'PERIOD': 1, 'WCTIMESTRING': '11:05 PM', 'PCTIMESTRING': '7:25', 'HOMEDESCRIPTION': None, 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': 'Thunder Timeout: Regular (Reg.1 Short 0)', 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 3, 'PLAYER1_ID': 1610612760, 'PLAYER1_NAME': None, 'PLAYER1_TEAM_ID': None, 'PLAYER1_TEAM_CITY': None, 'PLAYER1_TEAM_NICKNAME': None, 'PLAYER1_TEAM_ABBREVIATION': None, 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 15, 'visitor_score': 8}),
                StatsPbpEvent({'GAME_ID': '0021800002', 'EVENTNUM': 70, 'EVENTMSGTYPE': 3, 'EVENTMSGACTIONTYPE': 12, 'PERIOD': 1, 'WCTIMESTRING': '11:09 PM', 'PCTIMESTRING': '7:25', 'HOMEDESCRIPTION': 'Curry Free Throw 2 of 2 (7 PTS)', 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': None, 'SCORE': '8 - 16', 'SCOREMARGIN': '8', 'PERSON1TYPE': 4, 'PLAYER1_ID': 201939, 'PLAYER1_NAME': 'Stephen Curry', 'PLAYER1_TEAM_ID': 1610612744, 'PLAYER1_TEAM_CITY': 'Golden State', 'PLAYER1_TEAM_NICKNAME': 'Warriors', 'PLAYER1_TEAM_ABBREVIATION': 'GSW', 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 16, 'visitor_score': 8})
            ]
        )
        possession.PreviousPossessionEvents[2].next_event = possession.PreviousPossessionEvents[3]
        assert possession.previous_possession_has_timeout() is False

    def test_timeout_after_ft_is_counted(self):
        possession = PossessionDetails(
            PossessionNumber=7,
            EndTime=435,
            StartTime=445,
            Events=[
                StatsPbpEvent({'GAME_ID': '0021800002', 'EVENTNUM': 71, 'EVENTMSGTYPE': 5, 'EVENTMSGACTIONTYPE': 45, 'PERIOD': 1, 'WCTIMESTRING': '11:09 PM', 'PCTIMESTRING': '7:15', 'HOMEDESCRIPTION': None, 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': 'Schroder Out of Bounds - Bad Pass Turnover Turnover (P1.T3)', 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 5, 'PLAYER1_ID': 203471, 'PLAYER1_NAME': 'Dennis Schroder', 'PLAYER1_TEAM_ID': 1610612760, 'PLAYER1_TEAM_CITY': 'Oklahoma City', 'PLAYER1_TEAM_NICKNAME': 'Thunder', 'PLAYER1_TEAM_ABBREVIATION': 'OKC', 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 1, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 1, 'home_score': 16, 'visitor_score': 8}),
            ],
            PreviousPossessionEvents=[
                StatsPbpEvent({'GAME_ID': '0021800002', 'EVENTNUM': 66, 'EVENTMSGTYPE': 6, 'EVENTMSGACTIONTYPE': 2, 'PERIOD': 1, 'WCTIMESTRING': '11:05 PM', 'PCTIMESTRING': '7:25', 'HOMEDESCRIPTION': None, 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': 'Schroder S.FOUL (P1.T1) (B.Forte)', 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 5, 'PLAYER1_ID': 203471, 'PLAYER1_NAME': 'Dennis Schroder', 'PLAYER1_TEAM_ID': 1610612760, 'PLAYER1_TEAM_CITY': 'Oklahoma City', 'PLAYER1_TEAM_NICKNAME': 'Thunder', 'PLAYER1_TEAM_ABBREVIATION': 'OKC', 'PERSON2TYPE': 4, 'PLAYER2_ID': 201939, 'PLAYER2_NAME': 'Stephen Curry', 'PLAYER2_TEAM_ID': 1610612744, 'PLAYER2_TEAM_CITY': 'Golden State', 'PLAYER2_TEAM_NICKNAME': 'Warriors', 'PLAYER2_TEAM_ABBREVIATION': 'GSW', 'PERSON3TYPE': 1, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 1, 'home_score': 14, 'visitor_score': 8}),
                StatsPbpEvent({'GAME_ID': '0021800002', 'EVENTNUM': 68, 'EVENTMSGTYPE': 3, 'EVENTMSGACTIONTYPE': 11, 'PERIOD': 1, 'WCTIMESTRING': '11:05 PM', 'PCTIMESTRING': '7:25', 'HOMEDESCRIPTION': 'Curry Free Throw 1 of 2 (6 PTS)', 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': None, 'SCORE': '8 - 15', 'SCOREMARGIN': '7', 'PERSON1TYPE': 4, 'PLAYER1_ID': 201939, 'PLAYER1_NAME': 'Stephen Curry', 'PLAYER1_TEAM_ID': 1610612744, 'PLAYER1_TEAM_CITY': 'Golden State', 'PLAYER1_TEAM_NICKNAME': 'Warriors', 'PLAYER1_TEAM_ABBREVIATION': 'GSW', 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 15, 'visitor_score': 8}),
                StatsPbpEvent({'GAME_ID': '0021800002', 'EVENTNUM': 70, 'EVENTMSGTYPE': 3, 'EVENTMSGACTIONTYPE': 12, 'PERIOD': 1, 'WCTIMESTRING': '11:09 PM', 'PCTIMESTRING': '7:25', 'HOMEDESCRIPTION': 'Curry Free Throw 2 of 2 (7 PTS)', 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': None, 'SCORE': '8 - 16', 'SCOREMARGIN': '8', 'PERSON1TYPE': 4, 'PLAYER1_ID': 201939, 'PLAYER1_NAME': 'Stephen Curry', 'PLAYER1_TEAM_ID': 1610612744, 'PLAYER1_TEAM_CITY': 'Golden State', 'PLAYER1_TEAM_NICKNAME': 'Warriors', 'PLAYER1_TEAM_ABBREVIATION': 'GSW', 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 16, 'visitor_score': 8}),
                StatsPbpEvent({'GAME_ID': '0021800002', 'EVENTNUM': 69, 'EVENTMSGTYPE': 9, 'EVENTMSGACTIONTYPE': 1, 'PERIOD': 1, 'WCTIMESTRING': '11:05 PM', 'PCTIMESTRING': '7:25', 'HOMEDESCRIPTION': None, 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': 'Thunder Timeout: Regular (Reg.1 Short 0)', 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 3, 'PLAYER1_ID': 1610612760, 'PLAYER1_NAME': None, 'PLAYER1_TEAM_ID': None, 'PLAYER1_TEAM_CITY': None, 'PLAYER1_TEAM_NICKNAME': None, 'PLAYER1_TEAM_ABBREVIATION': None, 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 0, 'home_score': 15, 'visitor_score': 8}),
            ]
        )
        possession.PreviousPossessionEvents[3].next_event = possession.Events[0]
        assert possession.previous_possession_has_timeout() is True

    def test_rebound_out_of_order_exception_raised(self):
        possession = PossessionDetails(
            PossessionNumber=7,
            EndTime=132,
            StartTime=144,
            GameId='1',
            Period=2,
            Events=[
                StatsPbpEvent({'GAME_ID': '0021800001', 'EVENTNUM': 316, 'EVENTMSGTYPE': 2, 'EVENTMSGACTIONTYPE': 1, 'PERIOD': 2, 'WCTIMESTRING': '8:56 PM', 'PCTIMESTRING': '1:33', 'HOMEDESCRIPTION': "MISS Irving 25' 3PT Jump Shot", 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': None, 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 4, 'PLAYER1_ID': 202681, 'PLAYER1_NAME': 'Kyrie Irving', 'PLAYER1_TEAM_ID': 1610612738, 'PLAYER1_TEAM_CITY': 'Boston', 'PLAYER1_TEAM_NICKNAME': 'Celtics', 'PLAYER1_TEAM_ABBREVIATION': 'BOS', 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 1, 'home_score': 43, 'visitor_score': 40}),
                StatsPbpEvent({'GAME_ID': '0021800001', 'EVENTNUM': 339, 'EVENTMSGTYPE': 2, 'EVENTMSGACTIONTYPE': 97, 'PERIOD': 2, 'WCTIMESTRING': '8:56 PM', 'PCTIMESTRING': '1:32', 'HOMEDESCRIPTION': "MISS Brown 2' Tip Layup Shot", 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': None, 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 4, 'PLAYER1_ID': 1627759, 'PLAYER1_NAME': 'Jaylen Brown', 'PLAYER1_TEAM_ID': 1610612738, 'PLAYER1_TEAM_CITY': 'Boston', 'PLAYER1_TEAM_NICKNAME': 'Celtics', 'PLAYER1_TEAM_ABBREVIATION': 'BOS', 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 1, 'home_score': 43, 'visitor_score': 40}),
                StatsPbpEvent({'GAME_ID': '0021800001', 'EVENTNUM': 340, 'EVENTMSGTYPE': 4, 'EVENTMSGACTIONTYPE': 0, 'PERIOD': 2, 'WCTIMESTRING': '8:56 PM', 'PCTIMESTRING': '1:32', 'HOMEDESCRIPTION': 'Brown REBOUND (Off:2 Def:1)', 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': None, 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 4, 'PLAYER1_ID': 1627759, 'PLAYER1_NAME': 'Jaylen Brown', 'PLAYER1_TEAM_ID': 1610612738, 'PLAYER1_TEAM_CITY': 'Boston', 'PLAYER1_TEAM_NICKNAME': 'Celtics', 'PLAYER1_TEAM_ABBREVIATION': 'BOS', 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 1, 'home_score': 43, 'visitor_score': 40}),
                StatsPbpEvent({'GAME_ID': '0021800001', 'EVENTNUM': 317, 'EVENTMSGTYPE': 4, 'EVENTMSGACTIONTYPE': 0, 'PERIOD': 2, 'WCTIMESTRING': '8:57 PM', 'PCTIMESTRING': '1:32', 'HOMEDESCRIPTION': 'Brown REBOUND (Off:3 Def:1)', 'NEUTRALDESCRIPTION': None, 'VISITORDESCRIPTION': None, 'SCORE': None, 'SCOREMARGIN': None, 'PERSON1TYPE': 4, 'PLAYER1_ID': 1627759, 'PLAYER1_NAME': 'Jaylen Brown', 'PLAYER1_TEAM_ID': 1610612738, 'PLAYER1_TEAM_CITY': 'Boston', 'PLAYER1_TEAM_NICKNAME': 'Celtics', 'PLAYER1_TEAM_ABBREVIATION': 'BOS', 'PERSON2TYPE': 0, 'PLAYER2_ID': 0, 'PLAYER2_NAME': None, 'PLAYER2_TEAM_ID': None, 'PLAYER2_TEAM_CITY': None, 'PLAYER2_TEAM_NICKNAME': None, 'PLAYER2_TEAM_ABBREVIATION': None, 'PERSON3TYPE': 0, 'PLAYER3_ID': 0, 'PLAYER3_NAME': None, 'PLAYER3_TEAM_ID': None, 'PLAYER3_TEAM_CITY': None, 'PLAYER3_TEAM_NICKNAME': None, 'PLAYER3_TEAM_ABBREVIATION': None, 'VIDEO_AVAILABLE_FLAG': 1, 'home_score': 43, 'visitor_score': 40}),
            ],
            PreviousPossessionEvents=[]
        )
        possession.Events[0].next_event = possession.Events[1]
        possession.Events[1].next_event = possession.Events[2]
        possession.Events[2].next_event = possession.Events[3]
        possession.Events[3].next_event = None
        possession.Events[2].previous_event = possession.Events[1]
        possession.Events[3].previous_event = possession.Events[2]
        possession.Events[1].previous_event = possession.Events[0]
        possession.Events[0].previous_event = None
        possession.Events[0].order = 1
        possession.Events[1].order = 2
        possession.Events[2].order = 3
        possession.Events[3].order = 4

        rebounded_shots = [339]
        with pytest.raises(PbpEventOrderErrorException):
            assert possession.increment_rebound_counts(possession.Events[3], False, rebounded_shots)
